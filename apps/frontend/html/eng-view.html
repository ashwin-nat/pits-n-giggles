<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pits n' Giggles Engineer View {{ version }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/engView.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modals.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tyreSetsCards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lapSectorRecords.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tyreRecords.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fuelCalculator.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/barChart.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tyreStintHistoryModal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/raceStatsModal.css') }}">
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/msgpack-lite@0.1.26/dist/msgpack.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.4.2/tinycolor.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <!-- Global Data Section -->
        <div class="eng-view-global-data-section">
            <div class="row">
                <div class="col-md-8">
                    <div class="card border-secondary global-stats-section">
                        <div class="card-header border-secondary d-flex justify-content-between align-items-center global-stats-section-header">
                            <h5 class="mb-0" id="raceStatusHeader">Race Status</h5>
                            <div class="d-flex">
                                <span style="font-size: 2.1rem;" data-bs-toggle="tooltip" data-bs-title="This symbol shows up when a driver has set their telemetry to restricted">‚åÄ</span>
                                <button id="race-stats-btn" class="settings-button" data-bs-toggle="tooltip" data-bs-title="Show Race Stats">
                                    üèÅ
                                </button>
                                <a id="driver-view-btn" class="btn settings-button" href="/" data-bs-toggle="tooltip" data-bs-title="Switch to driver view">
                                    <i class="bi bi-car-front-fill"></i>
                                </a>
                                <button id="settings-btn" class="btn settings-button" data-bs-toggle="tooltip" data-bs-title="Table columns settings"><i class="bi bi-gear-fill"></i></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="eng-view-global-stat">
                                <label>Session Time</label>
                                <span id="sessionTime"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>Current Status</label>
                                <span id="raceStatus"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>Lap</label>
                                <span id="currentLap"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>SC Count</label>
                                <span id="scCount"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>VSC Count</label>
                                <span id="vscCount"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>Track Temp</label>
                                <span id="trackTemp"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>Air Temp</label>
                                <span id="airTemp"></span>
                            </div>
                            <div class="eng-view-global-stat">
                                <label>Pit Time Loss</label>
                                <span id="pitTimeLoss"></span>
                            </div>
                            <div class="eng-view-global-stat border border-secondary rounded p-2">
                                <label>Prediction Lap</label>
                                <div class="d-flex align-items-center">
                                    <input type="number" id="predictionLap" class="form-control form-control-sm bg-dark text-light border-secondary" value="1" min="1" max="80">
                                    <div class="ms-2 d-flex">
                                        <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" data-bs-title="Set prediction to pit lap (if available)">
                                            <button id="predictionPitBtn" class="btn btn-sm btn-secondary me-1">Pit</button>
                                        </span>
                                        <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" data-bs-title="Set prediction to mid-point lap">
                                            <button id="predictionMidBtn" class="btn btn-sm btn-secondary">Mid</button>
                                        </span>
                                        <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" data-bs-title="Set prediction to last lap">
                                            <button id="predictionLastBtn" class="btn btn-sm btn-secondary">Last</button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-secondary global-stats-section">
                        <div class="card-header border-secondary global-stats-section-header">
                            <h5>Weather Forecast</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm eng-view-weather-table">
                                    <tbody id="weatherTableBody">
                                        <!-- Weather data will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Race Table Section -->
        <div class="eng-view-race-table-section">
            <div id="eng-view-table" class="ag-theme-alpine-dark" style="height: 100%; width: 100%;"></div>
        </div>

        <!-- Column Visibility Pane -->
        <div id="column-visibility-pane" class="column-visibility-pane">
            <div class="pane-header">
                <h2>Column Settings</h2>
                <div>
                    <button id="reset-visibility-btn" class="btn btn-sm btn-secondary me-2" data-bs-toggle="tooltip" data-bs-title="Reset all column visibilities to default">Reset Visibilities</button>
                    <button id="reset-layout-btn" class="btn btn-sm btn-secondary me-2" data-bs-toggle="tooltip" data-bs-title="Reset all column positions and widths to default">Reset Layout</button>
                    <button id="close-pane-btn" class="btn-close btn-close-white" aria-label="Close"></button>
                </div>
            </div>
            <div class="pane-body">
                <div id="column-visibility-container">
                    <!-- Toggle switches will be populated here -->
                </div>
            </div>
        </div>

        <!-- Driver Details Modal -->
        <div class="modal fade" id="driverModal" tabindex="-1" aria-labelledby="driverModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen driver-modal-dialog">
                <div class="modal-content driver-modal-content bg-dark">
                    <!-- Modal Header -->
                    <div
                        class="modal-header driver-modal-header d-flex justify-content-between align-items-center bg-dark border border-dark-subtle rounded">
                        <!-- Title and Navigation Buttons -->
                        <div class="d-flex align-items-center">
                            <h5 class="modal-title m-0 text-white" id="driverModalLabel">Driver Details</h5>
                        </div>
                        <!-- Refresh and Close Buttons -->
                        <div class="d-flex align-items-center">
                            <button type="button" class="icon-btn me-2" id="refreshButtonDriver" title="Refresh">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                            <button type="button" class="icon-btn" id="closeButtonDriver" data-bs-dismiss="modal"
                                aria-label="Close" title="Close">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                    </div>
                    <div class="modal-body driver-modal-body border border-dark-subtle rounded d-flex flex-column">
                        <!-- Nav tabs and tab content will be dynamically injected here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Race Stats Modal -->
    <div class="modal fade" id="raceStatsModal" tabindex="-1" aria-labelledby="raceStatsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-fullscreen race-stats-modal-dialog">
        <div class="modal-content race-stats-modal-content bg-dark">
          <!-- Modal Header -->
          <div class="modal-header race-stats-modal-header d-flex justify-content-between align-items-center bg-dark border border-dark-subtle rounded">
            <!-- Title and Navigation Buttons -->
            <div class="d-flex align-items-center">
              <h5 class="modal-title m-0 text-white" id="raceStatsModalLabel">Race Stats</h5>
            </div>
            <!-- Refresh and Close Buttons -->
            <div class="d-flex align-items-center">
              <button type="button" class="icon-btn me-2" id="refreshButtonRace" title="Refresh">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
              <button type="button" class="icon-btn" id="closeButtonRace" data-bs-dismiss="modal" aria-label="Close" title="Close">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
          </div>
          <div class="modal-body race-stats-modal-body border border-dark-subtle rounded">
            <!-- Nav tabs and tab content will be dynamically injected here by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-body"></div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/preferences.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/iconCache.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modals.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graph.js') }}"></script>
    <script src="{{ url_for('static', filename='js/fuelCalculator.js') }}"></script>
    <script src="{{ url_for('static', filename='js/populateRaceControlMessagesTab.js') }}"></script>
    <script src="{{ url_for('static', filename='js/driverDataModalPopulator.js') }}"></script>
    <script src="{{ url_for('static', filename='js/raceStatsModalPopulator.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tyreSetsCards.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lapSectorRecords.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tyreRecords.js') }}"></script>
    <script src="{{ url_for('static', filename='js/weatherUI.js') }}"></script>
    <script src="{{ url_for('static', filename='js/barChart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tyreStintHistoryModal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/engView.js') }}"></script>
</body>
</html>